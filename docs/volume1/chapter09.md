# 第9話　アルゴリズムの話

　日曜日の午後、美月の部屋で約束通りパーサーの実装を始めた。デュアルモニターの前に二人で座り、VSCodeを開く。

「今日は簡単な数式パーサーから始めよう」

「はい。四則演算ができるやつですね」

「そう。でも意外と奥が深いよ」

　まず、ホワイトボードに文法を書いた。

```
expr   = term (('+' | '-') term)*
term   = factor (('*' | '/') factor)*
factor = number | '(' expr ')'
number = [0-9]+
```

「演算子の優先順位を文法で表現してるんですね」

「そう。乗除が加減より優先される」

　美月は素早く理解した。

「じゃあ、Rustで実装してみよう」

　キーボードを美月に渡して、一緒に考えながらコードを書いていく。

```rust
#[derive(Debug, Clone)]
enum Expr {
    Number(i32),
    Add(Box<Expr>, Box<Expr>),
    Sub(Box<Expr>, Box<Expr>),
    Mul(Box<Expr>, Box<Expr>),
    Div(Box<Expr>, Box<Expr>),
}
```

「ASTの定義から始めるんですね」

「うん。構文木があれば評価も簡単」

　美月が続きを書く。

```rust
struct Parser {
    input: Vec<char>,
    pos: usize,
}

impl Parser {
    fn new(input: &str) -> Self {
        Parser {
            input: input.chars().collect(),
            pos: 0,
        }
    }
    
    fn parse(&mut self) -> Result<Expr, String> {
        self.parse_expr()
    }
}
```

「いい感じ。エラー処理も考えてる」

「Result型、便利ですよね」

　二人で交代しながら、パーサーの各関数を実装していく。美月のタイピングは速くて正確だ。

「ここ、左再帰になってない？」

「あ、本当だ。書き換えないと」

　美月が問題点を見つけてくれた。一緒に考えながらデバッグする時間が楽しい。

　一時間ほどで基本的なパーサーが完成した。

「テスト書こう」

「はい」

```rust
#[test]
fn test_simple_expr() {
    let mut parser = Parser::new("2 + 3 * 4");
    let ast = parser.parse().unwrap();
    assert_eq!(eval(&ast), 14);
}
```

「グリーンになった！」

「やった」

　ハイタッチする。成功の喜びを共有できるのが嬉しい。

「次は変数とか関数も扱えるようにしたい」

「いいですね。簡単なプログラミング言語みたい」

「そう。これが言語処理系の第一歩」

　美月の目が輝いた。

「私も自分の言語作ってみたいです」

「どんな言語？」

「日本語っぽい構文で書けるやつとか」

「面白い！実装してみよう」

　アイデアについて議論していると、時間を忘れてしまう。

「あ、もう5時」

「早いね」

「でも、すごく充実してました」

　美月がGitHubにコードをプッシュする。きれいなコミットメッセージと共に。

「美月のコード、本当に読みやすい」

「ありがとうございます。拓海先輩に褒められると嬉しいです」

　片付けをしながら、美月が言った。

「パーサー、奥が深いですね」

「これでもまだ入口だよ」

「もっと学びたいです」

「一緒に勉強していこう」

　美月の部屋を出る時、彼女のお母さんに挨拶した。

「拓海くん、また来てね」

「はい、お邪魔しました」

　家への帰り道、今日のことを振り返る。美月と一緒にコードを書く時間は、本当に楽しい。技術的な成長だけじゃなく、二人で何かを作り上げる喜びがある。

　家に着いてGitHubを見ると、美月からさらにコミットが追加されていた。エラーメッセージの改善と、ドキュメントの追加。

　PRのコメントには「今日は楽しかったです。また一緒にコード書きましょうね」と書かれていた。

　僕も「もちろん。次は型システムも実装してみよう」と返信した。

　美月と出会えて本当によかった。技術的なパートナーとして、これ以上の相手はいないと思う。そして、それ以上の何かを感じ始めている自分もいる。