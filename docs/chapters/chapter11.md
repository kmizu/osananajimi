# 第11話 文化祭の準備

## 本格的な開発開始

「さて、文化祭まであと一ヶ月」山田先輩が部室のカレンダーを指差した。「そろそろ本格的に開発を始めないと」

僕たちはGitHubのプロジェクトボードを開いた。タスクが整理され、それぞれの進捗が一目で分かるようになっている。

「パーサーの基本部分はできてるから」僕が現状を報告した。「次は構文木の可視化部分だね」

「UIの基本設計も終わってます」美月がFigmaの画面を共有した。「ユーザーが入力したコードが、どう解析されるか段階的に見せる画面遷移を考えました」

田中君も準備万端だった。「テストケースの一覧作りました。エッジケースも含めて50パターンくらい」

## アーキテクチャの詳細設計

「全体のアーキテクチャ、もう一度確認しよう」僕がホワイトボードに図を描き始めた。

```
┌─────────────────┐
│   ユーザー入力   │
└────────┬────────┘
         │
┌────────▼────────┐
│  字句解析器     │ (Rust/WASM)
│  Lexer          │
└────────┬────────┘
         │ トークン列
┌────────▼────────┐
│  構文解析器     │ (Rust/WASM)
│  Parser         │
└────────┬────────┘
         │ AST
┌────────▼────────┐
│  可視化エンジン │ (TypeScript/D3.js)
│  Visualizer     │
└─────────────────┘
```

「WebAssemblyの部分、もう動いてる？」山田先輩が聞いた。

「基本的な部分は」僕がデモを見せた。「wasm-packでビルドして、JavaScriptから呼び出せるようにしてある」

```rust
#[wasm_bindgen]
pub fn parse_expression(input: &str) -> Result<JsValue, JsValue> {
    let lexer = Lexer::new(input);
    let mut parser = Parser::new(lexer);
    
    match parser.parse() {
        Ok(ast) => Ok(serde_wasm_bindgen::to_value(&ast)?),
        Err(e) => Err(JsValue::from_str(&format!("{:?}", e))),
    }
}
```

「すごい」田中君が感嘆した。「RustのコードがJavaScriptから使えるんですね」

## UI/UXの設計

「私の番ね」美月がプロトタイプを見せた。「まず、ユーザーが式を入力する画面」

画面には、シンプルな入力フィールドと、その下に3つのタブが並んでいた：「字句解析」「構文解析」「評価結果」。

「例えば『2 + 3 * 4』を入力すると」美月がデモを操作した。「字句解析タブで、文字列がトークンに分解される様子がアニメーションで表示される」

```typescript
const animateTokenization = (input: string, tokens: Token[]) => {
  const timeline = gsap.timeline();
  
  tokens.forEach((token, index) => {
    timeline.to(`#char-${token.start}`, {
      backgroundColor: getTokenColor(token.type),
      duration: 0.3,
      ease: "power2.inOut"
    }, index * 0.2);
  });
  
  return timeline;
};
```

「色分けがきれい」山田先輩が褒めた。「数値は青、演算子は緑、括弧は紫...直感的だね」

## 構文木の可視化

「構文解析タブでは」美月が続けた。「D3.jsを使って構文木を描画します」

画面に美しい木構造が現れた。ノードが順番に現れ、枝が伸びていくアニメーションが印象的だ。

「演算子の優先順位も視覚的に分かるように」美月が説明した。「掛け算のノードが足し算より下に来ることで、先に計算されることが理解できる」

僕は美月のセンスに改めて感心した。技術的に正確でありながら、視覚的にも美しい。

## エラーメッセージの工夫

「エラー処理も見せて」山田先輩がリクエストした。

美月が不正な入力「2 + + 3」を入力すると、エラーメッセージが表示された。

```
エラー: 予期しない演算子 '+' が位置 4 にあります
2 + + 3
    ^
期待される入力: 数値または '('
```

「位置も分かりやすく表示されるんだ」田中君が感心した。

「拓海先輩のアイデアです」美月が説明した。「エラーメッセージは学習の機会だから、できるだけ親切にって」

## 教育的な配慮

「一般の来場者向けに、チュートリアルモードも用意しました」美月が新しい画面を見せた。

「まず簡単な『1 + 1』から始めて、徐々に複雑な式に挑戦できるようになってます」

```typescript
const tutorials = [
  { expression: "1 + 1", hint: "最も基本的な足し算です" },
  { expression: "2 * 3", hint: "掛け算も試してみましょう" },
  { expression: "2 + 3 * 4", hint: "演算子の優先順位に注目！" },
  { expression: "(2 + 3) * 4", hint: "括弧で優先順位を変更できます" },
  // ...
];
```

「いいね」山田先輩が頷いた。「プログラミング未経験者でも楽しめそう」

## 技術的な挑戦

「実は一つ課題があって」僕が切り出した。「WebAssemblyのサイズが少し大きい。初回ロードに時間がかかる可能性がある」

「どのくらい？」山田先輩が聞いた。

「最適化前で300KB。wasm-optで最適化しても200KBくらい」

「うーん、モバイル回線だと厳しいかも」

田中君が提案した。「Service Workerでキャッシュするのはどうですか？」

「それいい！」僕は賛成した。「一度読み込めば、次からは高速に動作する」

美月も追加のアイデアを出した。「ローディング中も退屈しないように、プログラミング言語の豆知識を表示するとか」

## チーム開発の実感

作業を進めていると、それぞれの強みが自然に活きてくることを実感した。

僕がパーサーのバグに悩んでいると、田中君が書いたテストケースがそれを発見してくれた。美月のUIは、技術的な概念を誰にでも分かりやすく伝えてくれる。山田先輩の進行管理のおかげで、全体がスムーズに進んでいる。

「いいチームだな」山田先輩が満足そうに言った。「このまま行けば、素晴らしい展示になる」

## 帰り道の決意

「今日も遅くなっちゃったね」

美月と二人、夜の京都を歩いていた。プログラミング部での作業に熱中して、気づけば7時を過ぎていた。

「でも楽しかった」美月が言った。「みんなで一つのものを作り上げていく感じ」

「美月のおかげで、展示が生き生きしてきた」僕は正直な気持ちを伝えた。「技術だけじゃなく、使う人のことを考える大切さを教えてもらった」

美月の頬が少し赤くなった。「拓海先輩の技術があってこそよ。私一人じゃ、何も作れない」

「それは違うよ」僕は首を振った。「美月には、技術を人に伝える才能がある。それは僕にはないものだ」

二条通りの街灯の下、美月が立ち止まった。

「文化祭、絶対成功させようね」

「うん、みんなで力を合わせれば必ず」

その時、美月の真剣な眼差しに、僕の心臓が少し早く打った。仲間として、そして...それ以上の何かとして、美月の存在が大きくなっていることを感じた。